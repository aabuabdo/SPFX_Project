name: ğŸ§± SPFx Build and Package CI

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: windows-latest

    steps:
      # ğŸ§© 1. Ø³Ø­Ø¨ Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† GitHub
      - name: Checkout repository
        uses: actions/checkout@v4

      # âš™ï¸ 2. Ø¥Ø¹Ø¯Ø§Ø¯ Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      # ğŸ“¦ 3. ØªØ«Ø¨ÙŠØª Ø§Ù„Ø­Ø²Ù… npm install
      - name: Install dependencies
        working-directory: .
        run: npm install

      # ğŸ—ï¸ 4. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ SPFx
      - name: Build SPFx solution
        working-directory: .
        continue-on-error: true # âœ… ÙŠØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª
        run: gulp bundle --ship

      # ğŸ“¦ 5. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø²Ù…Ø© .sppkg
      - name: Package SPFx solution
        working-directory: .
        continue-on-error: true # âœ… ÙŠØªØ¬Ø§Ù‡Ù„ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª
        run: gulp package-solution --ship

      # ğŸ§° 6. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø²Ù…Ø©
      - name: Verify SPFx package exists
        working-directory: ./sharepoint/solution
        run: |
          echo "ğŸ“¦ Checking for SPFx package..."
          if (!(Test-Path *.sppkg)) {
            Write-Host "âŒ No SPFx package found!"; exit 1
          } else {
            Write-Host "âœ… SPFx package ready for deployment."
          }

      # ğŸ“¤ 7. Ø±ÙØ¹ Ø§Ù„Ø­Ø²Ù…Ø© ÙƒÙ€ Artifact
      - name: Upload SPFx package artifact
        uses: actions/upload-artifact@v4
        with:
          name: SPFx_Package
          path: sharepoint/solution/*.sppkg

      # ğŸ’¬ 8. Ø·Ø¨Ø§Ø¹Ø© Ù…Ù„Ø®Øµ Ø¨Ø§Ù„Ù†Ø¬Ø§Ø­
      - name: ğŸ‰ Done
        run: |
          echo "âœ… SPFx build and packaging completed successfully!"
          echo "ğŸ“¦ You can download the package from the 'Artifacts' tab in GitHub Actions."
